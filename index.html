<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Discord Embeds -->
    <meta content="Pause my music! - Alex ðŸ‘‹" property="og:title" />
    <meta content="Pause my music! Site contains crude words, don't come here if you don't like bad words" property="og:description" />
    <meta content="https://pause.thatalex.dev" property="og:url" />
    <meta content="https://thatalex.dev/static/img/services/spotify-logo.png" property="og:image" />
    <meta content="#000f54" data-react-helmet="true" name="theme-color" />

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="static/css/modal.css">
    <title>Pause! > Alex ðŸ‘‹</title>
</head>
<body>
    <h1>Pause!</h1>
    <p style="font-size:15px;"><a href="https://github.com/awexthedev/pause" target="_blank">Source Code on Github</a></p>
    <p style ="font-size:30px;">Ever wanted to fuck with someones music? Well, now you can fuck with mine!<br>I'm paying for this premium plan, and in turn, this gives me access to premium API routes to control my player.<br>
    This will be harshly rate limited, because I like listening to my music sometimes.</p>

        <hr width="80">

    <div id="content">
        <span style="font-size:50px; text-align:center;" id="contentString"></span>
        <i id="backward" onclick="skipToPrev()" class="fa fa-step-backward" style="font-size:25px; padding-right:10px;" aria-hidden="true"></i> 
        <i id="playPause" onclick="pauseSong()" class="fa fa-pause" style="font-size:25px;" aria-hidden="true"></i> 
        <i id="forward" onclick="skipSong()" class="fa fa-step-forward" style="font-size:25px; padding-left:10px;" aria-hidden="true"></i><br>

        <input type="text" style="width:20%; color:black;" id="messageContent" placeholder="Attach a message w/ your pause!"><br>
        <span style="font-size:20px;" id="noti"></span>
        <hr width="50px">

        <p><a style="color:white;" onclick="openQueueModal()" href="#">Queue a song</a></p>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
          <span class="close">&times;</span><br>
    
        <div style="text-align:center;">
            <h3>Add a song to the queue!</h3>
            <p style="color:maroon;">PLEASE NOTE! You need to provide a Spotify URI! Not a URL! The server will reject your suggestion if it is not properly formatted.<br>
            Please see the bottom of the website for more information on how to get this.</p>
            <input type="text" style="color:black;" id="uri" placeholder="Add a song to the queue!"><br>
            <input type="text" style="color:black;" id="qMessage" placeholder="Attach a message!"><br><br>
          <button type="button" onclick="qASong()">Submit</button><br><br>
    
          <div id="modalNoti"></div>
        </div>
        </div>
      
      </div>

    <hr>
    <h3>How do I get a Spotify URI?</h3>
        <p>URIs are different than Spotify URLs! Please follow the guide below;<br>
        <ul>
            <li>Navigate to a song</li>
            <li>Right click + hover over Share</li>
            <li>Hold CTRL or ALT. You'll see Copy Song URL change to Copy Spotify URI.</li>
            <li>Cash money</li>
        </ul>

        <a href="https://storage.thatalex.dev/screenshots/spotify_bbg0c5vwqu.gif" target="_blank">Gif of the process</a>
    </p>

    <script src="static/js/popup.js"></script>
    <script src="static/js/queue.js"></script>
    <script src="static/js/skipping.js"></script>
    <script src="static/js/electron.js"></script>
    <script src="static/js/checkTime.js"></script>
    <script>
        async function checkCookie() {
            if(document.cookie) {
                const cookie = document.cookie.split('; ').find(row => row.startsWith('lastRan=')).split('=')[1];
                const time = await checkTime(cookie);
                console.log(time)
                if(time) return true;
                else return false;
            } else return true;
        }
        
        async function pauseSong() {
            const message = document.getElementById("messageContent").value;
            if(!message) return document.getElementById("noti").innerHTML = `<p>At least send me a message before you rick roll me :(</p>`;

            if (!document.cookie) document.cookie = `lastRan=${new Date().getTime()}`;
            else if (!await checkCookie()) {
                return document.getElementById('noti').innerHTML = '<p>You have already used a player action in the last 5 minutes. Please give me time to regain my sanity :)</p>';
            }

            sendElectronMessage("skip");

            fetch("https://api.thatalex.dev/v0/web/spotify/pause", {
                method: "get",
                headers: {
                    "Content-Type": "application/json"
                }
            }).then(async function(resp) {
                const response = await resp.json();
                document.getElementById("noti").innerHTML = `<p>${response.message}</p>`;
            });
        }

        const data = fetch("https://api.thatalex.dev/v0/web/spotify/state").then(async function(response) {
            const data = await response.json();
            if(data.status != 401) document.getElementById("contentString").innerHTML = `<p> Currently playing:<br><strong>${data.data.songData.songName}</strong> by <strong>${data.data.songData.artists[0].name}</strong> at <strong>${data.data.device.volume}%</strong> volume.<br>Playing (not paused)? ${data.playing}</p>`;
            else { 
                console.log(`Uh oh! A fucky wucky popped up! >:3`) 
                document.getElementById("contentString").innerHTML = `<p style="color:red; font-size:25px;">${data.message}</p>`; 
                document.getElementById("button").style.display = `none`; 
            }
        });
    </script>
</body>
</html>

<style>
    body {
        background-color: black;
        color:white;
        text-align:center;
    }

    button {
        color:black;
    }

    ul {
        list-style:none;
        text-align:center;
    }
</style>